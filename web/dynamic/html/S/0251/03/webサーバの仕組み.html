<h2>webサーバ</h2>
webサーバとはクライアント(ブラウザ)からのHTTPリクエストを受けて、HTTPレスポンスを返す役割を果たします。<br />一般的には存在しているHTMLファイルをそのまま返しますが、今回はAPサーバの役割を兼ねて動的にHTMLを作成します。<br /><br />C#には、HttpListenerと呼ばれるクラスが用意されているため、こちらを使用してwebサーバを構築します。
<img src="/static/img/S00/0251/webServer.png" alt="webサーバ" />
また、HTTP(S)通信の下の層ではTCP通信を行っているため、TCPレベルでプログラムを構築することも可能です。<br />この場合は、より複雑なコードを書くことになりますが、柔軟で高速なプログラムを開発可能です。
<h2>IPアドレスと名前解決</h2>
<h3>IPアドレス</h3>
IPアドレスはネットワーク上での住所として使用されます。<br /><br />IPアドレスをもとにブラウザ(クライアント)は対象となるサーバを特定します。<br /><br />今回はサーバを外部に用意するのではなく、自分のPCをそのままサーバとして扱います。<br />したがって、自分自身を表す特殊なIPアドレス「127.0.0.1」を使用します。
<h3>名前解決</h3>
実際にwebサイトを閲覧する際に、皆さんはIPアドレスを直接入力することはしませんよね、、、<br />例えば、このページを閲覧する際には、「https://koko-campus.net/〇〇〇」というURLを使用していると思います。<br />この「koko-campus.net」の部分をIPアドレスに変換してwebサーバの所在を特定します。<br />ドメイン名をIPアドレスに変換する作業を名前解決と呼びます。<br /><br />「localhost」というドメインは「127.0.0.1」に変換されるため、代わりに「localhost」を使用することもできます。
<div class="separator"></div>
IPアドレスは容易に詐称が可能であるという問題点があります。<br /><br />手紙を出す際に、その署名欄では誰でも名乗れますよね、、、<br />そんな感じです。<br /><br />この問題を克服するためにトランスポート層で双方向での通信が行われます。
<h2>ポート</h2>
IPアドレスの詐称が可能な状態だと不便ですので、双方向でもやり取りをすることによって詐称を防ぎます。<br />これをスリーウェイハンドシェイクと呼び、インターネット層の上位にあるトランスポート層で行います。<br /><br />トランスポート層ではそれぞれのサービスごとにポートを使用して行われます。<br />使用するポートにはそれぞれ番号が割り振られ、ポート番号と呼ばれます。<br />代表的なポート番号を紹介します。
<table>
	<tbody>
		<tr>
			<th>21</th>
			<td>FTP</td>
		</tr>
		<tr>
			<th>22</th>
			<td>SSH</td>
		</tr>
		<tr>
			<th>25</th>
			<td>SMTP</td>
		</tr>
		<tr>
			<th>80</th>
			<td>HTTP</td>
		</tr>
		<tr>
			<th>443</th>
			<td>HTTPS</td>
		</tr>
	</tbody>
</table>
ポートは自由に変更可能ですが、ブラウザがHTTP(S)通信をする際には、デフォルトで「80」「443」番ポートを使用するので、これに合わせる必要があります。<br />意図的にブラウザでアクセスをさせたくない場合には、ポート番号を変えます。
<p>セキュリティの観点ではこれだけでは不十分ですので、注意して下さい。</p>
開発用では、「8000」「8080」「8888」「10080」「10443」を使用することが多いです。
<div class="separator"></div>
因みに、デフォルトの「80」「443」番ポート以外に通信をかけるときには「https://koko-campus.net:8080」のように、IPアドレス(ドメイン)の後ろに「:ポート番号」と指定します。
<h2>HTTPリクエスト・レスポンス</h2>
では実際に、ブラウザ(クライアント)・webサーバ間でやり取りされるデータについて確認しましょう♪
<h3>HTTPリクエスト</h3>
大きく以下の3つから構成されます。
<table>
	<tbody>
		<tr>
			<th>リクエスト部</th>
			<td>メソッド・対象URL・HTTPのバージョンを指定します。</td>
		</tr>
		<tr>
			<th>ヘッダ</th>
			<td>HTTP通信に関するメタデータを記述します。<br />文字コード・ブラウザ識別子・求めるデータタイプ・言語指定などが記述されます。</td>
		</tr>
		<tr>
			<th colspan="2">改行コード</th>
		</tr>
		<tr>
			<th>ボディ</th>
			<td>webサーバに送信するデータ部分です。<br />単純にwebページを閲覧する場合(GETメソッド)では使用されませんが、入力データを送信する場合(POSTメソッド)で使用されます。</td>
		</tr>
	</tbody>
</table>
<h3>HTTPレスポンス</h3>
HTTPレスポンスと構成は同じです。
<table>
	<tbody>
		<tr>
			<th>ステータス行</th>
			<td>HTTPレスポンスの状態を表します。<br />「200 Found」「404 Not Found」などです。</td>
		</tr>
		<tr>
			<th>ヘッダ</th>
			<td>HTTPリクエスト同様に、HTTPレスポンスに関するメタデータを記述します。</td>
		</tr>
		<tr>
			<th colspan="2">改行コード</th>
		</tr>
		<tr>
			<th>ボディ</th>
			<td>メインとなるデータです。<br />一般的にはここにHTMLが記述されます。</td>
		</tr>
	</tbody>
</table>
<h2>HTTPメソッド</h2>
HTTPのメソッドとして以下の2つがよく用いられます。
<ul>
	<li>GET</li>
	<li>POST</li>
</ul>
<h3>GETメソッド</h3>
一般的にはwebサーバからデータを受け取る際に使用されます。<br />webサーバにデータを送信することも可能で、その場合にはURLの後ろに「?AAA=BBB&amp;CCC=DDD&amp;EEE=FFF」という感じで、「?」の後ろにキーとバリューをセットにして、かつそれらを「&amp;」でつなげて記述します。<br /><br />この方法だと送信したデータが盗聴可能ですので、機密情報は扱うべきではありません。
<h3>POSTメソッド</h3>
HTTPリクエストのボディにデータを格納します。<br />暗号化通信の対象ですので、機密情報を扱う際にはこちらを使用します。
<h2>SSL/TLS通信</h2>
ブラウザ・webサーバ間のやり取りはインターネットを介して行われるため、盗聴が可能です。<br />これを防ぐために、インターネットに送信するデータを暗号化することが一般的です。<br /><br />この暗号手法を「SSL/TLS」と呼びます。
<p>現在ではSSLは廃止されてTLS通信のみ行われていますが、合わせてSSL/TLSと呼ぶことが多いです。</p>
この通信では、鍵と呼ばれる暗号(復号)アルゴリズムを使用します。<br /><br />SSL/TLSで暗号化されたHTTP通信を特にHTTPS通信と呼びます。
